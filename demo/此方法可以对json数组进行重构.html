<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>日历</title>
    </head>
<style>

  
</style>  
    <body>
     
    </body>

<script>
var y_arr1=[
    {'name':'ceshi1','c_name':'测试','Ename':'ceshizi11','C_Ename':'测试子11','value':'yyy11'},
    {'name':'ceshi1','c_name':'测试','Ename':'ceshizi12','C_Ename':'测试子12','value':'yyy12'},
    {'name':'ceshi2','c_name':'测试2','Ename':'ceshizi21','C_Ename':'测试子21','value':'yyy21'},
    {'name':'ceshi2','c_name':'测试2','Ename':'ceshizi22','C_Ename':'测试子22','value':'yyy22'},
    {'name':'ceshi3','c_name':'测试3','Ename':'ceshizi3','C_Ename':'测试子3','value':'yyy3'},
    {'name':'ceshi4','c_name':'测试4','Ename':'ceshizi4','C_Ename':'测试子4','value':'yyy4'}
  ]

var  target =[
{'name':'ceshi1','c_name':'测试','children':[{'Ename':'ceshizi11','C_Ename':'测试子11','value':'yyy11'},{'Ename':'ceshizi12','C_Ename':'测试子12','value':'yyy12'}]},

]


var y_arr2=[
    {'name':'ceshi','c_name':'测试','Ename':'ceshizi','C_Ename':'测试子','value':'yyy'},
    {'name':'ceshi','c_name':'测试','Ename':'ceshizi1','C_Ename':'测试子1','value':'yyy'},
    {'name':'ceshi2','c_name':'测试2','Ename':'ceshizi','C_Ename':'测试子','value':'yyy'},
    {'name':'ceshi2','c_name':'测试2','Ename':'ceshizi1','C_Ename':'测试子1','value':'yyy'},
    {'name':'ceshi3','c_name':'测试3','Ename':'ceshizi','C_Ename':'测试子','value':'yyy'},
    {'name':'ceshi4','c_name':'测试4','Ename':'ceshizi','C_Ename':'测试子','value':'yyy'}
  ]
function chai(obj){
  var y_arr=[]
  for(var i=0 ;i<obj.length;i++){
      y_arr.push({
        'name':obj[i].name,
        'c_name':obj[i].c_name,
        'children':[{
            'Ename':obj[i].Ename,
            'C_Ename':obj[i].C_Ename,
            'value':obj[i].value
        }]
    });
  }
  return y_arr;
}
function mubiao(obj){
  var arr=[],result=[],y_child=obj
  for(var i =0; i<obj.length; i++){  
    var $b = {'children':[]};  
    var t = y_child[i];
    if(arr.indexOf(t['name']) ==-1){  // 如果没有重复的 
      arr.push(t['name']);
      $b.name=t['name'];
      $b.c_name=t['c_name'];
      $b.children.push(t['children']);  //?
      result.push($b);
    }else{ //如果有重复的  添加到result里面去  位置 如何选择
      for(var j =0; j<result.length; j++){
          if(result[j].name == t['name']){
              result[j].children.push(t['children']);
          }
      }
    } 
  }
  return result
}
console.time(1);
console.log(mubiao(chai(y_arr1)))
console.timeEnd(1);

function getCNameIndex(obj,TargetArr){
    for(var i = 0;i<TargetArr.length;i++){
        if(TargetArr[i].c_name===obj.c_name){
            return i;
        }
    }
    TargetArr.push({
        'name':obj.name,
        'c_name':obj.c_name,
        'children':[]
    })
    return TargetArr.length-1;
}
function addChild(obj,TargetArr,index){
    TargetArr[index].children.push({
        'Ename':obj.Ename,
        'C_Ename':obj.C_Ename,
        'value':obj.value
    })
}
var target =[]

console.time(2);
y_arr1.forEach(function(x){
  var i =getCNameIndex(x,target);
  console.log(i)
  addChild(x,target,i)
})
console.timeEnd(2)
</script>
